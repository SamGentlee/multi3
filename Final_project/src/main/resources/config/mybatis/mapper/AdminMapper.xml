<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="three.admin.mapper.AdminMapper">
	<select id="dOrgList" resultType="DonationOrg">
		select * from donationOrg order by donOrgNum 
	</select>
	
	<select id="mainOrg" resultType="DonationOrg">
		select * from donationOrg where status=1
	</select>
	
	<insert id="addOrg" parameterType="DonationOrg" >
		<selectKey keyProperty="donOrgNum" resultType="int" order="BEFORE">
			select donationOrg_seq.nextval from dual
		</selectKey>
		insert into donationOrg values(#{donOrgNum},#{donName},#{donOrgInfo},#{donBankAccount},#{donBankName},0)
	</insert>
	
	<delete id="dondelete" parameterType="int" >
		delete from donationOrg where donOrgNum=#{donOrgNum}
	</delete>
	
	<update id="changeDon" parameterType="int" >
	{call
		declare
		begin
			update donationOrg set status=0 where exists(select*from donationOrg where status=1);
			update donationOrg set status=1 where donOrgNum=#{donOrgNum};
		end
	}
	</update>
	
	<select id="exchangeList" resultType="Exchange">
		select * from exchange order by exchangeTime asc
	</select>
	
	<delete id="exchangeDelete" parameterType="int">
		delete from exchange where exchangenum=#{value}	
	</delete>
	
	<select id="payList" resultType="Payment">
		select * from payment order by payTime
	</select>
	
	<delete id="cancelPay" parameterType="int">
		delete from payment where merchant_uid=#{merchant_uid}
	</delete>
	
	<select id="userList" resultType="User">
		select * from project_user where userStatus!=1
	</select>
	
	<update id="normalUser" parameterType="int">
		update project_user set userStatus=0 where userNum=#{value}
	</update>
	
	<update id="stopUser" parameterType="int">
		update project_user set userStatus=3 where userNum=#{value}
	</update>
	
	<select id="findUser" parameterType="String" resultType="User">
		select * from project_user where userId like '%'||#{value}||'%' and userstatus != 1 
	</select>
	
	<select id="findPayment" parameterType="int" resultType="Payment">
			select * from payment where merchant_uid=#{value}
	</select>
	
	<update id="resetPoint" parameterType="Payment">
		update project_user set userpoint=userpoint-#{paid_amount} where userId=#{buyer_id}
	</update>
	
	<select id="findExchange"  parameterType="int" resultType="Exchange">
		select * from exchange where exchangeNum=#{value}
	</select>
	
	<update id="rechargePoint" parameterType="Exchange" >
		update project_user set userPoint=userPoint+#{exchangePoint} where userid=#{userid}
	</update>
	
	
</mapper>